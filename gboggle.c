/* * File: gboggle.c * ----------------------------------------------------- * Implements the graphics support functions for Boggle program. * * * General implementation notes * ---------------------------- * This file implements the graphics support functions for the Boggle * program.  It makes straightforward use of the extended graphics * library to draw the dice, board, letters, scoreboard, etc. The  * implementations of the individual functions are fairly simple  * and many of the helper functions do not require individual comments.  * For descriptions of the behavior of the exported functions,  * please see the interface file. */#include "genlib.h"#include "strlib.h"#include "extgraph.h"#include "gboggle.h"#define DIMENSION 4							// number of cubes on a side#define CUBE_SIZE .50			// width & height of dice cubes#define CUBE_RADIUS .125		// radius for rounded corners on the dice#define BOARD_SIZE (DIMENSION*CUBE_SIZE)#define BORDER_WIDTH .26		// width of border around the dice#define UPPER_LEFT_X 1.75		// upper left corner of the board#define UPPER_LEFT_Y 3.0#define LINE_Y (UPPER_LEFT_Y + BORDER_WIDTH/2.0)#define SCORE_Y (LINE_Y + 0.06)#define WORD_Y (UPPER_LEFT_Y - 0.05)	// y coord of first line of words#define HUMAN_X 0.05			// x coord for Human's side of scoreboard#define COMPUTER_X (UPPER_LEFT_X + BOARD_SIZE + BORDER_WIDTH)#define LETTER_FONT "Helvetica"	// Font for letters in boxes#define LETTER_FONT_SIZE 24#define SCORE_FONT "Helvetica"	// Font for scoreboard names & values#define SCORE_FONT_SIZE 18#define WORD_FONT "Geneva"		// Font for word lists#define WORD_FONT_SIZE 9#define WORD_WIDTH .53			// Width of each word list column#define NUM_WORDS_IN_ROW 21		// Length of each word list column/*  * Two small global arrays are used:  One is to keep track of number of * words scored by each player (to place new words in the correct * location in the displayed word list) and the other is to record the * scores for each player (which must be saved and erased before updating. * We also track a global 2-d array of the letters currently showing on the * board, so that we can draw them inverted for the highlighting function. */static numWords[2];static scores[2];static char letters[DIMENSION][DIMENSION];/*  * These are the prototypes for functions private to this module.  These * helper functions are used to implement the functions which are exported  * from this module (see .h for prototypes of the exported functions) */static void DrawBox(double x, double y, double width, double height);static void FillBox(double x, double y, double width, double height, double fill, string color);static void DrawRoundedRect (double x, double y, double width, double height, double radius);static void FillRoundedRect (double x, double y,double width, double height, double radius, double fill, string color);static void DrawAndFillRoundedRect (double x, double y, double width, double height, double radius, double fill, string color);static void DrawCenteredChar(double centerX, double centerY, char ch);static void DrawCube(int row, int col, char ch, bool invert);static double CubeX(int col);static double CubeY(int row);static void DrawScoreboard(void);static void DrawDice(void);static void DrawBorder(void);static void DrawOneScore(Player playerNum, int value);static void AddToScoreForPlayer(int pointsToAdd, Player playerNum);static void InitColors(void); /*  * Function: DrawCube * ----------------------------- * Draws one cube in its position, including the letter centered in the middle of * the cube.  If invert flag is true, we reverse the background and letter colors. */static void DrawCube(int row, int col, char ch, bool invert){	DrawAndFillRoundedRect(CubeX(col), CubeY(row), CUBE_SIZE, CUBE_SIZE, 						CUBE_RADIUS, 1.0, (invert ? "Letter Color" : "Die Color"));    SetPenColor((invert ? "Die Color" : "Letter Color"));							DrawCenteredChar(CubeX(col) + CUBE_SIZE/2.0, CubeY(row) + CUBE_SIZE/2.0, ch);}/*  * Function: LabelCube * ------------------- * Exported function used to draw letters on cubes.  We set the 2-d array * at this position to hold the letter and then draw the cube in the un-highlighted * version with the letter added. */ void LabelCube(char ch, int row, int col){	letters[row][col] = ch;	DrawCube(row, col, ch, FALSE);}/*  * Function: HighlightCube * ----------------------------- * Exported function used to turn off and on highlight for cubes.  This function * is intended to highlight a cube which is currently being used to form a word.   */ void HighlightCube(int row, int col, bool lit){	DrawCube(row, col, letters[row][col], lit);	UpdateDisplay();}/*  * Function: DrawDice * ----------------------------- * Draws all of the dice in position.  The dice are drawn blank, * the client will fill in the letters by calling the exported function * function DrawLetterAtPosition. */static void DrawDice(void){	int row, col;	for (col = 0; col < DIMENSION; col++) 		for (row = 0; row < DIMENSION; row++)     		DrawCube(col, row, ' ', FALSE);	// erase all cubes, start with blank chars}/*  * Function: DrawScoreboard * ----------------------------- * Sets up the scoreboard, by drawing the player name labels and lines underneath them. */static void DrawScoreboard(void){	SetPenColor("Label Color");	MovePen(HUMAN_X ,LINE_Y);	DrawLine(UPPER_LEFT_X - BORDER_WIDTH - GetCurrentX() , 0);	MovePen(COMPUTER_X ,LINE_Y);	DrawLine(GetWindowWidth() - GetCurrentX(),0);	SetFont(SCORE_FONT);	SetPointSize(SCORE_FONT_SIZE);	MovePen(HUMAN_X, SCORE_Y);	DrawTextString("Me");	MovePen(COMPUTER_X, SCORE_Y);	DrawTextString("Computer");}/*  * Function: DrawBoard * ----------------------------- * Exported function to draw a new board.  Sets up named colors, draws the yellow * border, draws the empty dice, the labels on the scoreboard, and resets all sorts * and words lists to zero. */void DrawBoard(void){	InitColors();	DrawBorder();	DrawDice();	DrawScoreboard();	SetWindowTitle("Welcome to Boggle!");	scores[Human] = scores[Computer] = 0;	numWords[Human] = numWords[Computer] = 0;	UpdateDisplay();}/*  * Function: DrawBorder * ----------------------------- * Draws a simple filled border around the dice cubes in the yellow color * we all so fondly remember from our childhood. */static void DrawBorder(void){	double rectSize = BOARD_SIZE + BORDER_WIDTH;		FillBox(UPPER_LEFT_X - BORDER_WIDTH/2, UPPER_LEFT_Y - rectSize +BORDER_WIDTH/2, 		rectSize, rectSize, .5, "Board Color");}/*  * Function: DrawOneScore * ----------------------------- * Draws the specified score for the player according to player enum. */static void DrawOneScore(Player playerNum, int value){      	char buffer[4];      	sprintf(buffer,"%d", value);   	SetFont(SCORE_FONT);   	SetPointSize(SCORE_FONT_SIZE);	SetPenColor("Label Color");   	MovePen((playerNum == Human ? HUMAN_X :COMPUTER_X) + 1.25, SCORE_Y);	DrawTextString(buffer);}/*  * Function: AddToScoreForPlayer * ----------------------------- * Updates a player's score by the specified number of points. * Note that we must first erase the old score before drawing * the new one (otherwise we scribble & create chaos).  The * scores are kept in an array that is private to this module. */static void AddToScoreForPlayer(int pointsToAdd, Player playerNum){	SetEraseMode(TRUE);	DrawOneScore(playerNum, scores[playerNum]); // erase old score	SetEraseMode(FALSE);	scores[playerNum] += pointsToAdd;    DrawOneScore(playerNum, scores[playerNum]); // re-draw new score}/*  * Function: RecordWordForPlayer * ----------------------------- * Exported function to add a word to a player's list and update * their score accordingly.  It keeps track of the number of * words recorded for each player and position each successive word * in rows and columms from left to right, top to bottom.  It * also updates the scoreboards with point additions. */void RecordWordForPlayer(string word, Player playerNum){	int row, col, numWordsInRow;        SetFont(WORD_FONT);	SetPointSize(WORD_FONT_SIZE);	SetPenColor("Word Color");	numWordsInRow = (playerNum == Human) ? 3 : 5;	row = numWords[playerNum] / numWordsInRow;	col = numWords[playerNum] % numWordsInRow;   	MovePen ((playerNum == Human ? HUMAN_X : COMPUTER_X) + col*WORD_WIDTH,    			WORD_Y -row*GetFontHeight());    DrawTextString(word);    AddToScoreForPlayer(StringLength(word) - 3, playerNum); // +1 pt for each letter over length 4    numWords[playerNum]++;}// Color table of named colors and their RGB components.  We will init the table once// and define colors with those names so we can access colors by name later.static struct {	string colorName;	double red, green, blue;} colorTable[] = {	{"Board Color",	 1, .86, 0.05}, // yellow-orange	{"Die Color",  	.9, .9, .9},	// almost white	{"Letter Color", .01, .20, .85},// dark blue	{"Word Color", .01, .50, .30},	// med green-blue	{"Label Color",	.01, .45, .25},	// dark green-blue	0}; static void InitColors(void){    int i;	static bool beenHere = FALSE;     	if (beenHere) return; // Only want to do this once  	beenHere = TRUE;	i = 0;	while (colorTable[i].colorName) {		DefineColor(colorTable[i].colorName,    					colorTable[i].red,   					colorTable[i].green,    					colorTable[i].blue);   		i++;   	}}// Handy utility functions to return coordinates of the lower-left corner of // the cube at position (row, col).  The dice are numbered from top to bottom, // left to right starting from zero. Therefore, the upper left corner is (0,0), // lower right is (3,3)static double CubeX(int col){	return UPPER_LEFT_X + CUBE_SIZE*col;}static double CubeY(int row){	 return UPPER_LEFT_Y - CUBE_SIZE*(row+1); }    /*  * Function: DrawCenteredChar * ----------------------------- * Used to draw the letters in the center of the dice.  Can use * stack storage for buffer because we don't need the string * once we return from the function.  Using CharToString() would * have leaked a one-char string in the heap unless we were * careful to free it. Note that this function centers the char * both vertically and horizontally around the point specified. */ static void DrawCenteredChar(double centerX, double centerY, char ch){	char buffer[2];		buffer[0] = ch;	buffer[1] = '\0';  	SetFont(LETTER_FONT); 	SetPointSize(LETTER_FONT_SIZE);	MovePen(centerX - TextStringWidth(buffer)/2, centerY - GetFontAscent()/2);	DrawTextString(buffer);}/* Shape-drawing functions  * ------------------------------------ * These routines use graphics library to draw rects, fill them in, * draw rounded corner rects and fill them in, too. * */static void DrawBox(double x, double y, double width, double height){	MovePen(x, y);	DrawLine(width,0);	DrawLine(0,height);	DrawLine(-width,0);	DrawLine(0,-height);}static void FillBox(double x, double y, double width, double height, double fill, string color){	SetPenColor(color);	StartFilledRegion(fill);	DrawBox(x, y, width, height);	EndFilledRegion();}static void DrawRoundedRect (double x, double y, double width, double height, double radius){	MovePen(x + radius, y);	DrawLine(width -2*radius,0);		// line across bottom	DrawArc(radius,270,90);				// arc on lower right corner	DrawLine(0,height -2*radius);		// line up right side	DrawArc(radius,0,90);				// arc on upper right corner	DrawLine(-(width -2*radius), 0);	// line across top	DrawArc(radius,90,90);				// arc on upper left corner	DrawLine(0,-(height-2*radius));		// line down left side	DrawArc(radius,180,90);				// arc on lower left corner}static void FillRoundedRect (double x, double y,double width, double height, double radius, double fill, string color){	SetPenColor(color);	StartFilledRegion(fill);	DrawRoundedRect(x,y,width, height, radius);	EndFilledRegion();}static void DrawAndFillRoundedRect (double x, double y, double width, double height, double radius, double fill, string color){	FillRoundedRect(x, y,width, height, radius, fill, color);	SetPenColor("Black");	DrawRoundedRect(x, y, width, height, radius);}